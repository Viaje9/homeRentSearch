import{_ as j,u as C,r as m,w as L,o as h,c as g,a as t,b as I,d as k,p as R,e as U,f as D,g as N,F as P,h as V,n as M,t as r,i as z,j as B}from"./index-CCKs8Ifq.js";import"./leaflet-src-C0hSXGgz.js";const $=f=>(R("data-v-f2675929"),f=f(),U(),f),q={class:"relative min-h-276"},E=$(()=>t("p",{class:"arrow"},"<",-1)),F=[E],T=$(()=>t("p",{class:"arrow"},">",-1)),O=[T],A={key:0,class:"absolute w-full h-full opacity-50 top-0 left-0 bg-black"},G=$(()=>t("div",{class:"flex items-center justify-center w-full h-full"},[t("div",{class:"px-3 py-1 text-xl font-medium leading-none text-center text-white"}," loading... ")],-1)),H=[G],J={__name:"ProcessImg",props:{postId:{type:Number},imgUrl:{default:"",type:String}},setup(f){const _=C(),{prevImg:p,nextImg:y}=_,w=f,i=m(null),a=m([]),l=m(!1);L(()=>w.imgUrl,(c,s)=>{c!==s&&v(c)},{immediate:!0});function v(c){if(l.value=!0,a.value.some(d=>d.id===c)){const d=a.value.find(b=>b.id===c).canvasRef;i.value.width=d.width,i.value.height=d.height,i.value.getContext("2d").drawImage(d,0,0),l.value=!1;return}const s=new Image;s.src=c,s.onload=()=>{i.value.width=s==null?void 0:s.width,i.value.height=s==null?void 0:s.height,i.value.getContext("2d").drawImage(s,0,0),a.value.push({id:c,canvasRef:s}),l.value=!1},s.onerror=()=>{l.value=!1}}return(c,s)=>(h(),g("div",q,[t("div",{class:"prev",onClick:s[0]||(s[0]=d=>I(p)(f.postId))},F),t("div",{class:"next",onClick:s[1]||(s[1]=d=>I(y)(f.postId))},O),t("canvas",{class:"max-w-full",ref_key:"canvas",ref:i},null,512),l.value?(h(),g("div",A,H)):k("",!0)]))}},K=j(J,[["__scopeId","data-v-f2675929"]]),Q={class:"flex flex-wrap pb-24 justify-center"},W={class:"p-2"},X={class:"fs-7"},Y={key:0,class:"text-red-500 inline"},Z=t("br",null,null,-1),ee={class:"text-green-600"},te=["href"],se={class:"fixed bottom-0 left-0 z-50 w-full h-28 pb-4 bg-slate-500 border-t border-gray-200"},ne={class:"grid h-1/2 max-w-lg grid-cols-2 mx-auto font-medium"},oe={class:"grid h-1/2 max-w-lg grid-cols-4 mx-auto font-medium"},ae={class:"flex items-center justify-center col-span-2 text-white"},le={key:0,class:"fixed w-screen h-svh opacity-50 top-0 left-0 bg-black z-50"},re=t("div",{class:"flex items-center justify-center w-full h-full"},[t("div",{class:"px-3 py-1 text-xl font-medium leading-none text-center text-white"}," loading... ")],-1),ie=[re],de={__name:"ResultView",setup(f){const _=D(),p=C(),{setData:y,setRentUrlParams:w,getRentDataEventV2:i}=p,a=m(0),l=m(!1),v=m(!1),c=N(()=>p.rentData.reduce((u,n)=>{let e=u.find(o=>o.location===n.location);return e&&!v.value?e.count++:u.push({...n,count:1}),u},[]));function s(){if(a.value>0){a.value--;const u=b(a.value),n={...p.rentUrlParams,...u};l.value=!0,i(n).then(e=>{if(e.status===200){const{data:o}=e;w({...n,version:o.version,timestamp:o.timestamp}),y(o.rentList),_.push({name:"result"})}else alert(e.errorMsg)}).finally(()=>{l.value=!1})}}function d(){const u=Math.floor(+p.records/30);if(a.value<u-1){a.value++;const n=b(a.value),e={...p.rentUrlParams,...n};l.value=!0,i(e).then(o=>{if(o.status===200){const{data:x}=o;w({...e,version:x.version,timestamp:x.timestamp}),y(x.rentList),_.push({name:"result"})}else alert(o.errorMsg);window.scrollTo(0,0)}).finally(()=>{l.value=!1})}}const b=u=>({firstRow:u*30});function S(){w(""),_.push({name:"home"})}return(u,n)=>(h(),g(P,null,[t("div",Q,[(h(!0),g(P,null,V(c.value,e=>{var o,x;return h(),g("div",{key:e.id,class:"m-2",style:{width:"22rem"}},[z(K,{"post-id":e.id,"img-url":e.photoList[e.currentImgIndex]},null,8,["post-id","img-url"]),t("div",W,[t("p",X,[B(" 圖"+r(e.currentImgIndex+1)+"/"+r(e.photoList.length)+" ＄"+r(e.price)+" "+r(e.floorStr)+" "+r(e.area)+"坪 ",1),e.count!==1?(h(),g("p",Y,"重複次數 "+r(e.count),1)):k("",!0),Z,t("span",ee,r((o=e==null?void 0:e.surrounding)==null?void 0:o.desc)+r((x=e==null?void 0:e.surrounding)==null?void 0:x.distance),1)]),t("a",{class:"fs-7 text-blue-600",href:`https://rent.591.com.tw/rent-detail-${e.post_id}.html`,target:"_blank"},r(e.location),9,te)])])}),128))]),t("div",se,[t("div",ne,[t("button",{type:"button",class:"inline-flex flex-col items-center justify-center bg-slate-400 px-5 text-white",onClick:n[0]||(n[0]=e=>S())}," 重新查詢 "),t("span",{class:M(["inline-flex flex-col items-center justify-center px-5 text-white",{"bg-blue-500":v.value,"bg-gray-500":!v.value}]),onClick:n[1]||(n[1]=e=>v.value=!v.value)}," 顯示重複 ",2)]),t("div",oe,[t("button",{type:"button",class:"inline-flex flex-col items-center justify-center px-5 group text-white",onClick:n[2]||(n[2]=e=>s())}," 上一頁 "),t("span",ae,"第 "+r(a.value+1)+"/"+r(Math.floor(+I(p).records/30))+" 頁",1),t("button",{type:"button",class:"inline-flex flex-col items-center justify-center px-5 group text-white",onClick:n[3]||(n[3]=e=>d())}," 下一頁 ")])]),l.value?(h(),g("div",le,ie)):k("",!0)],64))}};export{de as default};
