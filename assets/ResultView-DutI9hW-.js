import{_ as j,u as C,r as g,w as V,o as v,c as h,a as t,b as k,d as I,p as B,e as D,f as M,g as T,h as N,i as R,v as S,F as U,j as q,t as c,k as z,l as E}from"./index-D2e6IO6D.js";import"./leaflet-src-C0hSXGgz.js";const $=f=>(B("data-v-f2675929"),f=f(),D(),f),F={class:"relative min-h-276"},O=$(()=>t("p",{class:"arrow"},"<",-1)),A=[O],G=$(()=>t("p",{class:"arrow"},">",-1)),H=[G],J={key:0,class:"absolute w-full h-full opacity-50 top-0 left-0 bg-black"},K=$(()=>t("div",{class:"flex items-center justify-center w-full h-full"},[t("div",{class:"px-3 py-1 text-xl font-medium leading-none text-center text-white"}," loading... ")],-1)),Q=[K],W={__name:"ProcessImg",props:{postId:{type:Number},imgUrl:{default:"",type:String}},setup(f){const _=C(),{prevImg:p,nextImg:b}=_,m=f,u=g(null),r=g([]),i=g(!1);V(()=>m.imgUrl,(n,s)=>{n!==s&&w(n)},{immediate:!0});function w(n){if(i.value=!0,r.value.some(d=>d.id===n)){const d=r.value.find(y=>y.id===n).canvasRef;u.value.width=d.width,u.value.height=d.height,u.value.getContext("2d").drawImage(d,0,0),i.value=!1;return}const s=new Image;s.src=n,s.onload=()=>{u.value.width=s==null?void 0:s.width,u.value.height=s==null?void 0:s.height,u.value.getContext("2d").drawImage(s,0,0),r.value.push({id:n,canvasRef:s}),i.value=!1},s.onerror=()=>{i.value=!1}}return(n,s)=>(v(),h("div",F,[t("div",{class:"prev",onClick:s[0]||(s[0]=d=>k(p)(f.postId))},A),t("div",{class:"next",onClick:s[1]||(s[1]=d=>k(b)(f.postId))},H),t("canvas",{class:"max-w-full",ref_key:"canvas",ref:u},null,512),i.value?(v(),h("div",J,Q)):I("",!0)]))}},X=j(W,[["__scopeId","data-v-f2675929"]]),Y={class:"items-center bg-slate-500"},Z={class:"text-white text-lg font-medium flex py-2"},ee={class:"pl-2 mr-2"},te=t("label",{for:"filterRepeat",class:"text-white text-lg"},"過濾重複",-1),se={class:"pl-2 mr-2"},oe=t("label",{for:"filterTopBottom",class:"text-white text-lg"},"過濾頂樓地下室",-1),le={class:"flex flex-wrap pb-24 justify-center"},ne={class:"p-2"},ae={class:"fs-7"},re={key:0,class:"text-red-500 inline"},ie=t("br",null,null,-1),ce={class:"text-green-600"},ue=["href"],de={class:"fixed bottom-0 left-0 z-50 w-full h-28 pb-4 bg-slate-500 border-t border-gray-200"},fe={class:"grid h-1/2 max-w-lg grid-cols-1 mx-auto font-medium"},pe={class:"grid h-1/2 max-w-lg grid-cols-4 mx-auto font-medium"},ve={class:"flex items-center justify-center col-span-2 text-white"},he={key:0,class:"fixed w-screen h-svh opacity-50 top-0 left-0 bg-black z-50"},ge=t("div",{class:"flex items-center justify-center w-full h-full"},[t("div",{class:"px-3 py-1 text-xl font-medium leading-none text-center text-white"}," loading... ")],-1),xe=[ge],we={__name:"ResultView",setup(f){const _=M(),p=C(),{setData:b,setRentUrlParams:m,getRentDataEventV2:u}=p,r=g(0),i=g(!1),w=g(!0),n=g(!0),s=T(()=>p.rentData.reduce((l,o)=>{let e=l.find(a=>a.location===o.location);return e&&w.value?e.count++:l.push({...o,count:1}),l},[]).filter(l=>n.value?l.allfloor!==l.floor&&l.floor>1:!0));function d(){if(r.value>0){r.value--;const l=P(r.value),o={...p.rentUrlParams,...l};i.value=!0,u(o).then(e=>{if(e.status===200){const{data:a}=e;m({...o,version:a.version,timestamp:a.timestamp}),b(a.rentList),_.push({name:"result"})}else alert(e.errorMsg)}).finally(()=>{i.value=!1})}}function y(){const l=Math.floor(+p.records/30);if(r.value<l-1){r.value++;const o=P(r.value),e={...p.rentUrlParams,...o};i.value=!0,u(e).then(a=>{if(a.status===200){const{data:x}=a;m({...e,version:x.version,timestamp:x.timestamp}),b(x.rentList),_.push({name:"result"})}else alert(a.errorMsg);window.scrollTo(0,0)}).finally(()=>{i.value=!1})}}const P=l=>({firstRow:l*30});function L(){m(""),_.push({name:"home"})}return N(()=>{window.scrollTo(0,0)}),(l,o)=>(v(),h(U,null,[t("div",Y,[t("div",Z,[t("div",ee,[R(t("input",{type:"checkbox",id:"filterRepeat","onUpdate:modelValue":o[0]||(o[0]=e=>w.value=e),class:"mr-2"},null,512),[[S,w.value]]),te]),t("div",se,[R(t("input",{type:"checkbox",id:"filterTopBottom","onUpdate:modelValue":o[1]||(o[1]=e=>n.value=e),class:"mr-2"},null,512),[[S,n.value]]),oe])])]),t("div",le,[(v(!0),h(U,null,q(s.value,e=>{var a,x;return v(),h("div",{key:e.id,class:"m-2",style:{width:"22rem"}},[z(X,{"post-id":e.id,"img-url":e.photoList[e.currentImgIndex]},null,8,["post-id","img-url"]),t("div",ne,[t("p",ae,[E(" 圖"+c(e.currentImgIndex+1)+"/"+c(e.photoList.length)+" ＄"+c(e.price)+" "+c(e.floorStr)+" "+c(e.area)+"坪 ",1),e.count!==1?(v(),h("p",re,"重複次數 "+c(e.count),1)):I("",!0),ie,t("span",ce,c((a=e==null?void 0:e.surrounding)==null?void 0:a.desc)+c((x=e==null?void 0:e.surrounding)==null?void 0:x.distance),1)]),t("a",{class:"fs-7 text-blue-600",href:`https://rent.591.com.tw/rent-detail-${e.post_id}.html`,target:"_blank"},c(e.location),9,ue)])])}),128))]),t("div",de,[t("div",fe,[t("button",{type:"button",class:"inline-flex flex-col items-center justify-center bg-slate-400 px-5 text-white",onClick:o[2]||(o[2]=e=>L())}," 重新查詢 ")]),t("div",pe,[t("button",{type:"button",class:"inline-flex flex-col items-center justify-center px-5 group text-white",onClick:o[3]||(o[3]=e=>d())}," 上一頁 "),t("span",ve,"第 "+c(r.value+1)+"/"+c(Math.floor(+k(p).records/30))+" 頁",1),t("button",{type:"button",class:"inline-flex flex-col items-center justify-center px-5 group text-white",onClick:o[4]||(o[4]=e=>y())}," 下一頁 ")])]),i.value?(v(),h("div",he,xe)):I("",!0)],64))}};export{we as default};
